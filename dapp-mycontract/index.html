<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dapp MyContract</title>
  <link rel="stylesheet" href="./resources/index.css" />
  <script src="./resources/web3.min.js"></script>
</head>

<body>
  <div class="container">
    <h1>dApp MyContract</h1>
    <h2 id="instructor"></h2>
    <label for="enderecoDaConta" class="col-lg-2 control-label">Endereço da Conta:</label>
    <h4 id="enderecoDaConta"></h4>

    <label for="fName" class="col-lg-2 control-label">Nome</label>
    <input type="text" id="fName" />

    <button id="btnEnviar">Enviar</button>
    <button id="btnObter">Obter</button>
  </div>

  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script>
    // // obter uma instância do Web3 para conexão com a rede blockchain
    // //     via provedor MetaMask ou acesso direto a blockchain local (ganache)
    // if (typeof web3 !== "undefined") {
    //   web3 = new Web3(web3.currentProvider);
    // } else {
    //   web3 = new Web3(
    //     new Web3.providers.HttpProvider("HTTP://127.0.0.1:7545")
    //   );
    // }

    // // Obter a conta padrão do usuário de acesso a blockchain
    // web3.eth.getAccounts(function (err, accounts) {
    //   if (err != null) {
    //     console.log(err);
    //   } else if (accounts.length === 0) {
    //     console.log("Metamask is locked!");
    //   } else {
    //     web3.eth.defaultAccount = accounts[0];
    //     $("#enderecoDaConta").html(web3.eth.defaultAccount);
    //   }
    // });

    if (typeof web3 !== 'undefined') {
      web3 = new Web3(web3.currentProvider);

    } else {
      web3 = new Web3(new Web3.providers.HttpProvider("HTTP://127.0.0.1:7545"));

    }


    web3.eth.getAccounts(function (err, accounts) {
      if (err != null) {
        console.log(err);
      } else if (accounts.length === 0) {
        console.log('MetaMask is locked');
      } else {
        web3.eth.defaultAccount = accounts[0];
        $("#enderecoDaConta").html(web3.eth.defaultAccount);
      }
    });

    // Definir ABI do seu smart contract
    /*
     *  A definição ABI é um arquivo JSON que fornece as funções disponíveis
     *     para chamar seu contrato.
     */
    var ABIContract = web3.eth.contract([{
        "inputs": [{
          "internalType": "string",
          "name": "_nome",
          "type": "string"
        }],
        "name": "setNome",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "stateMutability": "nonpayable",
        "type": "constructor"
      },
      {
        "inputs": [],
        "name": "getNome",
        "outputs": [{
          "internalType": "string",
          "name": "",
          "type": "string"
        }],
        "stateMutability": "view",
        "type": "function"
      }
    ]);

    // Definição do endereço do seu smart contract
    var SmartContract = ABIContract.at(
      "0xA7889B7520dD7f18425F09D7fd2924cAc76B53FC"
    );

    $("#btnEnviar").click(() => {
      SmartContract.setNome($("#fName").val(), function (err, result) {
        if (!err) {
          console.log(result);
        } else {
          console.log(err);
        }
      });
    });

    $("#btnObter").click(() => {
      SmartContract.getNome(function (err, result) {
        if (!err) {
          $("#instructor").html(result + "Seja Bem-Vindo");
          console.log(result);
        } else {
          console.log(err);
        }
      });
    });
  </script>
</body>

</html>